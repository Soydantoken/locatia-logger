<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Locatia Admin Paneli</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    async function loadLogs() {
      const response = await fetch('https://locatia-logger.vercel.app/api/logs');
      const logs = await response.json();
      const tbody = document.getElementById('log-body');
      document.getElementById('log-count').innerText = logs.length;
      tbody.innerHTML = '';
      logs.forEach(entry => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${new Date(entry.time).toLocaleString('tr-TR')}</td>
          <td>${entry.ip}</td>
          <td>${entry.lat}, ${entry.lon}</td>
          <td>${entry.ua}</td>
        `;
        tbody.appendChild(row);
      });
    }

    async function clearLogs() {
      const confirmClear = confirm("Tüm kayıtları silmek istediğinizden emin misiniz?");
      if (!confirmClear) return;
      await fetch('https://locatia-logger.vercel.app/api/logs', {
        method: 'DELETE'
      });
      loadLogs();
    }

    async function exportToPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFontSize(12);
      doc.text("Locatia - Log Raporu", 10, 10);

      const rows = document.querySelectorAll("#log-body tr");
      let y = 20;
      rows.forEach((tr, index) => {
        const cols = tr.querySelectorAll("td");
        const rowText = Array.from(cols).map(td => td.innerText).join(" | ");
        if (y > 280) {
          doc.addPage();
          y = 20;
        }
        doc.text(rowText, 10, y);
        y += 10;
      });

      doc.save("locatia_log_raporu.pdf");
    }

    function checkPassword() {
      const pass = prompt("Admin paneline giriş için şifre girin:");
      if (pass !== "admin123") {
        document.body.innerHTML = '<div class="text-center mt-5 text-danger"><h3>Yetkisiz giriş</h3><p>Admin paneline erişim reddedildi.</p></div>';
      }
    }

    window.onload = () => {
      checkPassword();
      loadLogs();
    };
  </script>
</head>
<body class="bg-light">
  <div class="container py-5">
    <h1 class="text-center mb-4">Locatia - Admin Panel</h1>
    <p class="text-center text-muted">Toplam Kayıt: <span id="log-count">0</span></p>
    <table class="table table-bordered table-striped">
      <thead class="table-dark">
        <tr>
          <th>Zaman</th>
          <th>IP</th>
          <th>Konum</th>
          <th>Cihaz Bilgisi</th>
        </tr>
      </thead>
      <tbody id="log-body">
        <tr><td colspan="4" class="text-center">Yükleniyor...</td></tr>
      </tbody>
    </table>
    <div class="d-flex justify-content-center gap-3 mt-4">
      <button class="btn btn-outline-primary" onclick="loadLogs()">Yenile</button>
      <button class="btn btn-outline-danger" onclick="clearLogs()">Tümünü Sil</button>
      <button class="btn btn-outline-secondary" onclick="exportToPDF()">PDF Olarak Dışa Aktar</button>
    </div>
    <div class="text-center mt-5">
      <h3 class="fw-bold">1 Aylık Lisans</h3>
      <p class="lead text-success">1599 TL</p>
      <p class="mb-0">Tüm sistemlere tam erişim</p>
    </div>
  </div>
  <footer class="text-center py-3 bg-dark text-white">
    <small>&copy; 2025 Locatia | <a href="/admin.html" class="text-info">Yönetici Paneli</a></small>
  </footer>
</body>
</html>

</html>
